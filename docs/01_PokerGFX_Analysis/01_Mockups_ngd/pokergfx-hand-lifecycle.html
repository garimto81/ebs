<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=720, initial-scale=1.0">
    <title>PokerGFX Hand Lifecycle - Sequence Diagram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #0a0e1a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        svg {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <svg viewBox="0 0 720 1280" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <!-- Arrow markers -->
            <marker id="arrow-sync" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                <polygon points="0,0 8,4 0,8" fill="#3b82f6"/>
            </marker>
            <marker id="arrow-async" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                <polygon points="0,0 8,4 0,8" fill="#6366f1"/>
            </marker>
            <marker id="arrow-return" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                <polygon points="0,0 8,4 0,8" fill="#10b981"/>
            </marker>

            <!-- Participant box gradient -->
            <linearGradient id="grad-normal" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#1e293b;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#334155;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="grad-highlight" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#1e3a5f;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#2563eb;stop-opacity:1" />
            </linearGradient>

            <!-- Common text styles -->
            <style>
                .participant-text { font-family: 'Segoe UI', sans-serif; font-size: 9px; font-weight: 600; fill: #f1f5f9; text-anchor: middle; }
                .label-text { font-family: 'Segoe UI', sans-serif; font-size: 9px; fill: #cbd5e1; text-anchor: middle; }
                .source-text { font-family: 'Segoe UI', sans-serif; font-size: 7.5px; fill: #64748b; font-style: italic; text-anchor: middle; }
                .step-text { font-family: 'Segoe UI', sans-serif; font-size: 10px; font-weight: 600; fill: white; text-anchor: middle; }
                .security-text { font-family: 'Segoe UI', sans-serif; font-size: 8px; fill: #cbd5e1; }
                .security-title { font-family: 'Segoe UI', sans-serif; font-size: 10px; font-weight: 600; fill: #60a5fa; }
                .legend-text { font-family: 'Segoe UI', sans-serif; font-size: 10px; fill: #cbd5e1; }
            </style>
        </defs>

        <!-- Background -->
        <rect width="720" height="1280" fill="#121620"/>

        <!-- Title -->
        <text x="360" y="28" font-family="'Segoe UI', sans-serif" font-size="20" font-weight="600" fill="#fafafa" text-anchor="middle">PokerGFX Hand Lifecycle</text>
        <text x="360" y="46" font-family="'Segoe UI', sans-serif" font-size="11" fill="#a1a1aa" text-anchor="middle">RFID 감지부터 방송 화면 표시까지 전체 데이터 파이프라인 시퀀스</text>

        <!-- Column centers: 52, 155, 258, 360, 462, 565, 668 -->

        <!-- TOP PARTICIPANTS -->
        <!-- P1: RFID 카드/안테나 -->
        <rect x="9" y="60" width="86" height="38" rx="4" fill="url(#grad-normal)" stroke="#475569" stroke-width="1.5"/>
        <text x="52" y="78" class="participant-text"><tspan x="52">RFID 카드</tspan><tspan x="52" dy="11">/안테나</tspan></text>

        <!-- P2: Tags.cs (highlight) -->
        <rect x="112" y="60" width="86" height="38" rx="4" fill="url(#grad-highlight)" stroke="#3b82f6" stroke-width="1.5"/>
        <text x="155" y="78" class="participant-text"><tspan x="155">Tags.cs</tspan><tspan x="155" dy="11">(RFID 서비스)</tspan></text>

        <!-- P3: Server (highlight) -->
        <rect x="215" y="60" width="86" height="38" rx="4" fill="url(#grad-highlight)" stroke="#3b82f6" stroke-width="1.5"/>
        <text x="258" y="78" class="participant-text"><tspan x="258">Server</tspan><tspan x="258" dy="11">(gfx.cs)</tspan></text>

        <!-- P4: GameCards Service -->
        <rect x="317" y="60" width="86" height="38" rx="4" fill="url(#grad-normal)" stroke="#475569" stroke-width="1.5"/>
        <text x="360" y="78" class="participant-text"><tspan x="360">GameCards</tspan><tspan x="360" dy="11">Service</tspan></text>

        <!-- P5: render.cs (highlight) -->
        <rect x="419" y="60" width="86" height="38" rx="4" fill="url(#grad-highlight)" stroke="#3b82f6" stroke-width="1.5"/>
        <text x="462" y="78" class="participant-text">render.cs</text>

        <!-- P6: Graphic Element -->
        <rect x="522" y="60" width="86" height="38" rx="4" fill="url(#grad-normal)" stroke="#475569" stroke-width="1.5"/>
        <text x="565" y="78" class="participant-text"><tspan x="565">Graphic</tspan><tspan x="565" dy="11">Element</tspan></text>

        <!-- P7: NDI/ATEM 출력 -->
        <rect x="625" y="60" width="86" height="38" rx="4" fill="url(#grad-normal)" stroke="#475569" stroke-width="1.5"/>
        <text x="668" y="78" class="participant-text"><tspan x="668">NDI/ATEM</tspan><tspan x="668" dy="11">출력</tspan></text>

        <!-- LIFELINES (dashed) -->
        <line x1="52" y1="110" x2="52" y2="1150" stroke="#475569" stroke-width="1.5" stroke-dasharray="4,4"/>
        <line x1="155" y1="110" x2="155" y2="1150" stroke="#475569" stroke-width="1.5" stroke-dasharray="4,4"/>
        <line x1="258" y1="110" x2="258" y2="1150" stroke="#475569" stroke-width="1.5" stroke-dasharray="4,4"/>
        <line x1="360" y1="110" x2="360" y2="1150" stroke="#475569" stroke-width="1.5" stroke-dasharray="4,4"/>
        <line x1="462" y1="110" x2="462" y2="1150" stroke="#475569" stroke-width="1.5" stroke-dasharray="4,4"/>
        <line x1="565" y1="110" x2="565" y2="1150" stroke="#475569" stroke-width="1.5" stroke-dasharray="4,4"/>
        <line x1="668" y1="110" x2="668" y2="1150" stroke="#475569" stroke-width="1.5" stroke-dasharray="4,4"/>

        <!-- STEP 1: RFID → Tags.cs -->
        <rect x="12" y="128" width="55" height="22" rx="3" fill="#7c3aed"/>
        <text x="39.5" y="143" class="step-text">Step 1</text>

        <line x1="52" y1="140" x2="155" y2="140" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow-sync)"/>
        <rect x="78" y="118" width="105" height="26" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="130.5" y="130" class="label-text"><tspan x="130.5">tag_event_delegate</tspan><tspan x="130.5" dy="10">(UID + antenna #)</tspan></text>
        <text x="103.5" y="156" class="source-text">Tags.cs:5412</text>

        <!-- STEP 2: Self-calls on Tags.cs -->
        <rect x="12" y="188" width="55" height="22" rx="3" fill="#7c3aed"/>
        <text x="39.5" y="203" class="step-text">Step 2</text>

        <!-- Self-call 1 -->
        <path d="M 155 200 L 195 200 L 195 230 L 155 230" fill="none" stroke="#f59e0b" stroke-width="2"/>
        <polygon points="155,230 160,225 160,235" fill="#f59e0b"/>
        <rect x="200" y="205" width="80" height="26" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="240" y="217" class="label-text"><tspan x="240">OnTagEvent</tspan><tspan x="240" dy="10">(diff_tags)</tspan></text>

        <!-- Self-call 2 -->
        <path d="M 155 250 L 195 250 L 195 280 L 155 280" fill="none" stroke="#f59e0b" stroke-width="2"/>
        <polygon points="155,280 160,275 160,285" fill="#f59e0b"/>
        <rect x="200" y="255" width="80" height="26" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="240" y="267" class="label-text"><tspan x="240">lock(tag_list)</tspan><tspan x="240" dy="10">UID → "As"</tspan></text>

        <!-- STEP 3: Tags.cs → Server -->
        <rect x="12" y="308" width="55" height="22" rx="3" fill="#7c3aed"/>
        <text x="39.5" y="323" class="step-text">Step 3</text>

        <line x1="155" y1="320" x2="258" y2="320" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow-sync)"/>
        <rect x="168" y="293" width="77" height="30" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="206.5" y="304" class="label-text"><tspan x="206.5">CardEvent(on, "As")</tspan><tspan x="206.5" dy="10">or PlayerEvent(...)</tspan></text>
        <text x="206.5" y="338" class="source-text">Tags.cs:5623</text>

        <!-- SECURITY DELAY BOX -->
        <rect x="258" y="360" width="410" height="120" rx="6" fill="rgba(59, 130, 246, 0.05)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="6,4"/>
        <rect x="275" y="354" width="95" height="16" rx="3" fill="#1e293b"/>
        <text x="322.5" y="365" class="security-title">보안 딜레이 분기</text>

        <rect x="270" y="380" width="180" height="28" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="278" y="391" class="security-text"><tspan x="278" font-weight="600">Trustless Mode:</tspan></text>
        <text x="278" y="402" class="security-text">딜레이 버퍼 (1~30분) → Viewer</text>

        <rect x="270" y="416" width="180" height="28" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="278" y="427" class="security-text"><tspan x="278" font-weight="600">Realtime Mode:</tspan></text>
        <text x="278" y="438" class="security-text">즉시 Viewer 전달</text>

        <rect x="465" y="380" width="180" height="28" rx="3" fill="#065f46" stroke="#10b981" stroke-width="1"/>
        <text x="473" y="391" class="security-text" fill="#6ee7b7"><tspan x="473" font-weight="600">Action Tracker:</tspan></text>
        <text x="473" y="402" class="security-text" fill="#6ee7b7">항상 즉시 전달</text>

        <!-- STEP 4: Server self-call + Server → GameCards -->
        <rect x="12" y="508" width="55" height="22" rx="3" fill="#7c3aed"/>
        <text x="39.5" y="523" class="step-text">Step 4</text>

        <!-- Self-call -->
        <path d="M 258 520 L 298 520 L 298 550 L 258 550" fill="none" stroke="#f59e0b" stroke-width="2"/>
        <polygon points="258,550 263,545 263,555" fill="#f59e0b"/>
        <rect x="303" y="525" width="75" height="26" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="340.5" y="537" class="label-text"><tspan x="340.5">GameType.</tspan><tspan x="340.5" dy="10">ProcessCard...</tspan></text>
        <text x="340.5" y="564" class="source-text">Server.cs:2341</text>

        <!-- GetNewCards -->
        <line x1="258" y1="575" x2="360" y2="575" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow-sync)"/>
        <rect x="280" y="560" width="68" height="16" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="314" y="571" class="label-text">GetNewCards()</text>

        <!-- Return -->
        <line x1="360" y1="600" x2="258" y2="600" stroke="#10b981" stroke-width="2" stroke-dasharray="4,2" marker-end="url(#arrow-return)"/>
        <rect x="283" y="588" width="60" height="16" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="313" y="599" class="label-text">["As", "Kh"]</text>

        <!-- STEP 5: Server → render.cs -->
        <rect x="12" y="638" width="55" height="22" rx="3" fill="#7c3aed"/>
        <text x="39.5" y="653" class="step-text">Step 5</text>

        <line x1="258" y1="650" x2="462" y2="650" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow-sync)"/>
        <rect x="325" y="635" width="90" height="16" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="370" y="646" class="label-text">init_hand(log._hand)</text>
        <text x="360" y="666" class="source-text">Server.cs:3456</text>

        <!-- Self-call on render.cs -->
        <path d="M 462 675 L 502 675 L 502 705 L 462 705" fill="none" stroke="#f59e0b" stroke-width="2"/>
        <polygon points="462,705 467,700 467,710" fill="#f59e0b"/>
        <rect x="507" y="680" width="70" height="26" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="542" y="692" class="label-text"><tspan x="542">좌석 매핑</tspan><tspan x="542" dy="10">가시성 설정</tspan></text>

        <!-- STEP 6: render.cs → Server (async return) + Server → Graphic Element -->
        <rect x="12" y="738" width="55" height="22" rx="3" fill="#7c3aed"/>
        <text x="39.5" y="753" class="step-text">Step 6</text>

        <!-- Async return arrow -->
        <line x1="462" y1="750" x2="258" y2="750" stroke="#6366f1" stroke-width="2" stroke-dasharray="4,2" marker-end="url(#arrow-async)"/>
        <rect x="322" y="735" width="78" height="26" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="361" y="747" class="label-text"><tspan x="361">render_event</tspan><tspan x="361" dy="10">(game_event)</tspan></text>
        <text x="360" y="770" class="source-text">render.cs:1823</text>

        <!-- Server → Graphic Element -->
        <line x1="258" y1="790" x2="565" y2="790" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow-sync)"/>
        <rect x="365" y="775" width="95" height="26" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="412.5" y="787" class="label-text"><tspan x="412.5">데이터 업데이트 +</tspan><tspan x="412.5" dy="10">트랜지션 트리거</tspan></text>
        <text x="411.5" y="808" class="source-text">Server.cs:3789</text>

        <!-- STEP 7: Graphic Element self-calls -->
        <rect x="12" y="838" width="55" height="22" rx="3" fill="#7c3aed"/>
        <text x="39.5" y="853" class="step-text">Step 7</text>

        <!-- Self-call 1 -->
        <path d="M 565 850 L 605 850 L 605 880 L 565 880" fill="none" stroke="#f59e0b" stroke-width="2"/>
        <polygon points="565,880 570,875 570,885" fill="#f59e0b"/>
        <rect x="610" y="857" width="95" height="16" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="657.5" y="868" class="label-text">UpdateAnimations()</text>

        <!-- Self-call 2 -->
        <path d="M 565 900 L 605 900 L 605 930 L 565 930" fill="none" stroke="#f59e0b" stroke-width="2"/>
        <polygon points="565,930 570,925 570,935" fill="#f59e0b"/>
        <rect x="610" y="905" width="95" height="26" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="657.5" y="917" class="label-text"><tspan x="657.5">RenderElement()</tspan><tspan x="657.5" dy="10">Transform, Z-order</tspan></text>
        <text x="657.5" y="946" class="source-text">GfxElement.cs:4567</text>

        <!-- STEP 8: Graphic Element → NDI/ATEM -->
        <rect x="12" y="968" width="55" height="22" rx="3" fill="#7c3aed"/>
        <text x="39.5" y="983" class="step-text">Step 8</text>

        <line x1="565" y1="980" x2="668" y2="980" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow-sync)"/>
        <rect x="585" y="965" width="68" height="26" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="619" y="977" class="label-text"><tspan x="619">canvas.Render()</tspan><tspan x="619" dy="10">→ 프레임 출력</tspan></text>
        <text x="616.5" y="1002" class="source-text">GfxElement.cs:5012</text>

        <!-- Self-call on NDI -->
        <rect x="578" y="1015" width="82" height="26" rx="3" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="619" y="1027" class="label-text"><tspan x="619">ATEM 스위처</tspan><tspan x="619" dy="10">카메라 합성</tspan></text>
        <path d="M 668 1010 L 700 1010 L 700 1040 L 668 1040" fill="none" stroke="#10b981" stroke-width="2"/>
        <polygon points="668,1040 673,1035 673,1045" fill="#10b981"/>

        <!-- BOTTOM PARTICIPANTS (same as top) -->
        <rect x="9" y="1165" width="86" height="38" rx="4" fill="url(#grad-normal)" stroke="#475569" stroke-width="1.5"/>
        <text x="52" y="1183" class="participant-text"><tspan x="52">RFID 카드</tspan><tspan x="52" dy="11">/안테나</tspan></text>

        <rect x="112" y="1165" width="86" height="38" rx="4" fill="url(#grad-highlight)" stroke="#3b82f6" stroke-width="1.5"/>
        <text x="155" y="1183" class="participant-text"><tspan x="155">Tags.cs</tspan><tspan x="155" dy="11">(RFID 서비스)</tspan></text>

        <rect x="215" y="1165" width="86" height="38" rx="4" fill="url(#grad-highlight)" stroke="#3b82f6" stroke-width="1.5"/>
        <text x="258" y="1183" class="participant-text"><tspan x="258">Server</tspan><tspan x="258" dy="11">(gfx.cs)</tspan></text>

        <rect x="317" y="1165" width="86" height="38" rx="4" fill="url(#grad-normal)" stroke="#475569" stroke-width="1.5"/>
        <text x="360" y="1183" class="participant-text"><tspan x="360">GameCards</tspan><tspan x="360" dy="11">Service</tspan></text>

        <rect x="419" y="1165" width="86" height="38" rx="4" fill="url(#grad-highlight)" stroke="#3b82f6" stroke-width="1.5"/>
        <text x="462" y="1183" class="participant-text">render.cs</text>

        <rect x="522" y="1165" width="86" height="38" rx="4" fill="url(#grad-normal)" stroke="#475569" stroke-width="1.5"/>
        <text x="565" y="1183" class="participant-text"><tspan x="565">Graphic</tspan><tspan x="565" dy="11">Element</tspan></text>

        <rect x="625" y="1165" width="86" height="38" rx="4" fill="url(#grad-normal)" stroke="#475569" stroke-width="1.5"/>
        <text x="668" y="1183" class="participant-text"><tspan x="668">NDI/ATEM</tspan><tspan x="668" dy="11">출력</tspan></text>

        <!-- LEGEND -->
        <rect x="20" y="1220" width="680" height="48" rx="5" fill="#1e293b" stroke="#334155" stroke-width="1"/>
        <text x="30" y="1235" font-family="'Segoe UI', sans-serif" font-size="12" font-weight="600" fill="#f1f5f9">범례</text>

        <!-- Legend items -->
        <line x1="30" y1="1248" x2="65" y2="1248" stroke="#3b82f6" stroke-width="2"/>
        <polygon points="65,1248 60,1245 60,1251" fill="#3b82f6"/>
        <text x="72" y="1252" class="legend-text">동기 호출</text>

        <line x1="180" y1="1248" x2="215" y2="1248" stroke="#6366f1" stroke-width="2" stroke-dasharray="4,2"/>
        <polygon points="215,1248 210,1245 210,1251" fill="#6366f1"/>
        <text x="222" y="1252" class="legend-text">비동기 호출</text>

        <line x1="350" y1="1248" x2="385" y2="1248" stroke="#10b981" stroke-width="2" stroke-dasharray="4,2"/>
        <polygon points="350,1248 355,1245 355,1251" fill="#10b981"/>
        <text x="392" y="1252" class="legend-text">응답 (Return)</text>

        <path d="M 530 1243 L 550 1243 L 550 1253 L 530 1253" fill="none" stroke="#f59e0b" stroke-width="2"/>
        <polygon points="530,1253 535,1250 535,1256" fill="#f59e0b"/>
        <text x="557" y="1252" class="legend-text">자기 호출 (Self-call)</text>
    </svg>
</body>
</html>
