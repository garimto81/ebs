# 결정: Stage 0에서 MFRC522 모듈 선택

**작성일**: 2026-01-30
**결정 상태**: 확정 (Stage 0)
**효력 범위**: Stage 0 - Stage 3 (업그레이드 경로 포함)
**관련 문서**:
- [DESIGN-RFID-Hardware.md](../stage-0/DESIGN-RFID-Hardware.md#141-가격대별-전체-비교표)
- [PRD-0003-EBS-RFID-System.md](../PRD-0003-EBS-RFID-System.md)

---

## 1. 결정 요약

**Stage 0에서는 MFRC522 (RC522) RFID 리더 모듈을 선택합니다.**

| 항목 | 내용 |
|------|------|
| **선택 모듈** | MFRC522 (RC522) |
| **가격** | $1-5 (AliExpress), ₩5,000-15,000 (국내) |
| **읽기 거리** | 3-5cm |
| **인터페이스** | SPI / I2C |
| **지원 프로토콜** | ISO 14443A |
| **카드 호환** | MIFARE Classic / Ultralight (포커 카드 표준) |
| **ESP32 호환** | 완벽 ✅ |
| **향후 업그레이드** | Stage 1+: ST25R3911B로 전환 가능 |

---

## 2. 선택 근거 (3가지 핵심)

### 2.1 최저 비용 - DIY 진입장벽 최소화

MFRC522는 **가장 저렴한 옵션**으로, 프로토타입 개발 단계에서 투자 위험을 최소화합니다.

| 모듈 | 가격 | 가격대 | 선택 기준 |
|------|------|--------|----------|
| **MFRC522** | $1-5 | **가장 저가** ⭐ | Stage 0 선택 |
| PN5180 | $5-8 | 저가 | - |
| PN532 클론 | $6-10 | 저가 | - |
| ST25R3911B | $25-40 | 중가 | Stage 1+ 검토 |
| PN532 정품 | $10-15 | 중저가 | - |

**이점**:
- 소수 모듈 구매(5-10개) 시 총 비용 $10-50 수준
- 초기 R&D 예산 제약 없음
- 실패해도 경제적 손실 최소

---

### 2.2 최다 튜토리얼 & 커뮤니티 라이브러리

MFRC522는 **Arduino 에코시스템에서 가장 널리 사용되는** RFID 리더로, 풍부한 예제와 라이브러리가 존재합니다.

#### 2.2.1 공식 라이브러리

| 라이브러리 | URL | 별점 | 유지보수 |
|-----------|-----|------|---------|
| **miguelbalboa/rfid** | https://github.com/miguelbalboa/rfid | ⭐⭐⭐⭐⭐ (13.8K+) | 활성 |
| ESP32 예제 | Arduino IDE 내장 | - | 공식 |

```cpp
// Arduino IDE 내 MFRC522 예제 코드
#include <SPI.h>
#include <MFRC522.h>

#define SS_PIN 5
#define RST_PIN 0

MFRC522 mfrc522(SS_PIN, RST_PIN);

void setup() {
  SPI.begin();
  mfrc522.PCD_Init();
}

void loop() {
  if (mfrc522.PICC_IsNewCardPresent()) {
    mfrc522.PICC_ReadCardSerial();
    // 카드 UID 읽기 완료
  }
}
```

#### 2.2.2 튜토리얼 자료

| 자료 | URL | 품질 | 대상 |
|------|-----|------|------|
| **Random Nerd Tutorials - ESP32 + MFRC522** | https://randomnerdtutorials.com/esp32-mfrc522-rfid-reader-arduino/ | ⭐⭐⭐⭐⭐ | 초보자 최적 |
| Arduino 공식 문서 | https://docs.arduino.cc | ⭐⭐⭐⭐ | 레퍼런스 |
| GitHub Topics | https://github.com/topics/mfrc522 | ⭐⭐⭐⭐ | 응용 사례 |

**이점**:
- 팀 하드웨어 경험 없음 → 튜토리얼 의존도 높음
- Stack Overflow에 50+ 활발한 질답
- YouTube에 100+ 영어/한글 튜토리얼

---

### 2.3 ESP32 3.3V 직접 연결 (레벨 변환 불필요)

MFRC522는 **3.3V 동작** 칩으로, ESP32와 **직접 연결** 가능합니다. 복잡한 전자 배경이 없는 팀에 최적입니다.

#### 2.3.1 배선도 (레벨 변환 없음)

```
ESP32           MFRC522
3.3V    ──────  VCC
GND     ──────  GND
GPIO5   ──────  SDA (CS)
GPIO18  ──────  SCK
GPIO23  ──────  MOSI
GPIO19  ──────  MISO
GPIO4   ──────  RST
```

**이점**:
- 레벨 변환기(Logic Level Shifter) 불필요
- 배선 간단 (7개 핀만 연결)
- 오류 가능성 최소

#### 2.3.2 다른 모듈과의 비교

| 모듈 | 전압 | 레벨 변환 | 배선 복잡도 |
|------|------|----------|-----------|
| **MFRC522** | 3.3V | ❌ 불필요 | 간단 ⭐ |
| PN5180 | 3.3V | ❌ 불필요 | 간단 |
| ST25R3911B | 3.3V | ❌ 불필요 | 보통 |
| PN532 클론 | 5V 호환 | ⚠️ 권장 | 복잡 |

**특별 주의**: MFRC522를 5V에 연결하면 **ESP32 영구 손상** 위험

---

## 3. 대안 비교표

### 3.1 모든 RFID 리더 모듈 비교 (Stage 0 - Stage 3)

| 모듈 | 가격 | 거리 | 프로토콜 | ESP32 | 라이브러리 | 포커 적합 | 권장 Stage |
|------|------|------|---------|-------|-----------|----------|-----------|
| **MFRC522** ⭐ | $1-5 | 3-5cm | ISO14443A | ✅ 우수 | miguelbalboa/rfid | ⭐⭐⭐⭐⭐ | **0** |
| RDM6300 | $2-4 | 5-8cm | 125kHz | ✅ | 있음 | ❌ 주파수불일치 | - |
| PN5180 | $5-8 | 15-20cm* | ISO15693+ISO14443 | ✅ 좋음 | 성장중 | ⚠️ 조건부 | 1 |
| PN532 클론 | $6-10 | 4-5cm | ISO14443+NFC | ✅ 좋음 | Adafruit | ✅⭐⭐⭐ | 1 |
| PN532 정품 | $10-15 | 4-5cm | ISO14443+NFC | ✅ 우수 | Adafruit | ✅⭐⭐⭐ | 1 |
| CLRC663 | $10-15 | 5-7cm | 다중 프로토콜 | ✅ 좋음 | NXP | ✅⭐⭐⭐ | 1 |
| PN7150 | $15-25 | 5cm | ISO14443+NFC | ✅ 우수 | 신규 | ✅⭐⭐⭐ | 2 |
| ST25R3911B | $25-40 | 7cm | ISO14443+ISO15693+NFC | ✅ 우수 | STM | ✅⭐⭐⭐⭐ | **1-2** |
| ST25R3916 | $30-50 | 7cm+ | EMVCo 인증 | ✅ 우수 | STM | ✅⭐⭐⭐⭐ | 2 |

**범례**:
- `*` PN5180 15-20cm는 ISO15693 카드 전용 (MIFARE는 여전히 4-5cm)
- 가격은 2026-01 기준, 변동 가능

### 3.2 Stage별 추천 경로

```
Stage 0: MFRC522 ($1-5)
         ↓ (프로토타입 검증 완료)

Stage 1-2: ST25R3911B 업그레이드 ($25-40)
          (성능 요구도 증가 시)
         ↓ (산업용 수준 필요)

Stage 3: ST25R3916 또는 커스텀 PCB
        (EMVCo 인증, POS급 신뢰성)
```

---

## 4. 거부된 대안과 사유

### 4.1 RDM6300 - 주파수 불일치 ❌

**사유**: RDM6300은 **125kHz (LF 저주파)** 프로토콜을 사용하지만, 포커 카드는 **13.56MHz (HF 고주파)** 표준입니다.

| 항목 | RDM6300 | 포커 카드 표준 |
|------|---------|---------------|
| 주파수 | 125kHz (LF) | 13.56MHz (HF) |
| 거리 | 5-8cm | 3-5cm |
| 호환성 | ❌ 불호환 | ✅ ISO14443A |

**결론**: 포커 카드를 읽을 수 없음.

### 4.2 PN532 클론 - 품질 불안정 ⚠️

**사유**: 저가 클론 제품의 불량률이 높아서 Stage 0 프로토타입에 부적합합니다.

| 항목 | 정품 | 클론 |
|------|------|------|
| 가격 | $10-15 | $6-10 |
| 불량률 | <5% | 15-30% |
| A/S | 있음 | 없음 |
| 안정성 | ✅ | ⚠️ 편차 큼 |

**결론**: 초기 테스트는 MFRC522로 충분. 클론은 회피.

### 4.3 PN5180 - 카드 호환 조건부 ⚠️

**사유**: PN5180이 제공하는 15-20cm 장거리 읽기는 **ISO15693 카드 전용**이며, 표준 MIFARE 포커 카드는 여전히 4-5cm입니다.

| 항목 | PN5180 + ISO15693 | PN5180 + MIFARE |
|------|-------------------|-----------------|
| 거리 | 15-20cm ✅ | 4-5cm (MFRC522과 동일) |
| 카드 구매 | 추가 필요 | 기존 표준 |
| 비용 | $5-8 (리더) + 새 카드 | $1-5 (리더만) |

**결론**: 기존 MIFARE 포커 카드로는 이점 없음. Stage 0에서는 불필요.

### 4.4 상용 솔루션 (PokerGFX, RF Poker) - 커스터마이징 불가 ❌

**사유**: EBS는 자체 소프트웨어 스택을 개발하는 프로젝트로, 완제품 솔루션은 목표에 맞지 않습니다.

| 항목 | 상용 솔루션 | EBS 목표 |
|------|------------|---------|
| 하드웨어 | 폐쇄형 | 커스터마이징 가능 |
| 소프트웨어 | 독점 | 자체 개발 (Python + React) |
| 비용 | $5,000+ | $100-500 (초기) |

**결론**: 범위 외. 불가.

---

## 5. 업그레이드 경로 및 마이그레이션

### 5.1 Stage 1-2로의 전환 조건

다음 중 **하나 이상**이 필요하면 ST25R3911B로 업그레이드를 검토합니다:

| 조건 | 증상 | 해결책 |
|------|------|--------|
| **읽기 거리 부족** | 카드가 5cm 이상 거리에서 감지 안 됨 | ST25R3911B (7cm) |
| **읽기 안정성** | 방송 중 간헐적 감지 오류 | ST25R3911B 또는 ST25R3916 |
| **성능 병목** | RFID 인식 지연 (>100ms) | PN532 정품 또는 ST25R3911B |
| **전문가 기능** | 결제 단말 호환 필요 | ST25R3916 (EMVCo 인증) |

### 5.2 펌웨어 마이그레이션 (MFRC522 → ST25R3911B)

**이점**: 펌웨어 수정만으로 업그레이드 가능, 하드웨어 재설계 불필요

#### 단계별 마이그레이션

```
Stage 0 (현재)
└─ MFRC522 + ESP32
   └─ firmware/rfid_reader.cpp 사용

Stage 1-2 (필요 시)
└─ ST25R3911B + ESP32
   └─ firmware/rfid_reader.cpp 수정 (라이브러리만 변경)
   └─ 나머지 코드 유지

기존 코드 호환성
├─ Serial JSON 포맷 유지 가능
├─ Python 서버 무변경
└─ React 프론트엔드 무변경
```

#### 코드 마이그레이션 예시

```cpp
// Stage 0: MFRC522 사용
#include <MFRC522.h>
MFRC522 reader(SS_PIN, RST_PIN);

// Stage 1 마이그레이션: 라이브러리만 변경
#include <ST25R3911B.h>  // 동일한 인터페이스
ST25R3911B reader(SS_PIN, RST_PIN);

// 나머지 코드는 동일 (readSerial() 등)
```

---

## 6. 리스크 분석

### 6.1 MFRC522 알려진 문제

| 리스크 | 심각도 | 완화 방법 |
|--------|--------|----------|
| **저가 클론 불량** | 중간 | 국내 신뢰 판매처 구매 (디바이스마트, 엘레파츠) |
| **5V 연결 손상** | 높음 | 배선도 검증 자동화 (초보자 체크리스트) |
| **4-5cm 거리 제약** | 낮음 | 카드 읽기 위치 최적화 (안테나 배치) |
| **간헐적 감지 오류** | 중간 | CRC 재시도 로직 (firmware) |

### 6.2 완화 계획

| 리스크 | 조치 | 담당 |
|--------|------|------|
| **불량률** | 초기 5개 구매 후 테스트, 문제 시 다시 구매 | 하드웨어 담당 |
| **5V 손상** | 배선도 다이어그램 + LED 테스트 장치 | 펌웨어 담당 |
| **감지 오류** | 읽기 재시도 로직 (3회) 구현 | 펌웨어 담당 |

---

## 7. 검증 기준 (Stage 0 완료 조건)

다음 기준을 만족하면 MFRC522 선택 결정이 **검증됨**:

| 검증 항목 | 기준 | 상태 |
|----------|------|------|
| **하드웨어 연결** | MFRC522 ↔ ESP32 SPI 통신 안정적 | 진행 중 |
| **카드 인식** | 표준 MIFARE 포커 카드 인식 (3-5cm) | 진행 중 |
| **응답 시간** | 카드 감지 후 UID 전송 <100ms | 진행 중 |
| **신뢰성** | 1,000회 연속 읽기 성공률 >95% | 진행 중 |
| **문서화** | firmware/README.md + 배선도 완성 | 진행 중 |
| **가격 확인** | 구매처별 최종 가격 확인 | 진행 중 |

---

## 8. 참고 자료

### 8.1 기술 문서

| 문서 | URL / 경로 |
|------|-----------|
| RFID 리더 비교 | docs/stage-0/DESIGN-RFID-Hardware.md (Section 1.4) |
| MCU 선택 | docs/stage-0/DESIGN-RFID-Hardware.md (Section 1.3) |
| 포커 카드/공급망 | docs/research/RESEARCH-RFID-Poker-Suppliers.md |
| Master PRD | docs/PRD-0003-EBS-RFID-System.md |

### 8.2 외부 자료

| 자료 | URL | 유형 |
|------|-----|------|
| Random Nerd Tutorials | https://randomnerdtutorials.com/esp32-mfrc522-rfid-reader-arduino/ | 튜토리얼 |
| miguelbalboa/rfid | https://github.com/miguelbalboa/rfid | 라이브러리 |
| MFRC522 Datasheet | https://www.nxp.com/products/wireless/nfc/rfid-readers/13-56-mhz-rfid-readers/mfrc522:MC33908 | 스펙 |
| Arduino RFID | https://docs.arduino.cc/built-in-examples/communication/Blink | 공식 예제 |

### 8.3 구매처

| 판매처 | 가격대 | 배송 | URL |
|--------|--------|------|-----|
| AliExpress | $1-2 | 2-4주 | https://www.aliexpress.com |
| Amazon | $5-8 (키트) | 2-3일 | https://www.amazon.com |
| 국내 - 디바이스마트 | ₩5,000-15,000 | 1-2일 | https://www.devicemart.co.kr |
| 국내 - 엘레파츠 | ₩7,000-12,000 | 1일 | https://www.eleparts.co.kr |

---

## 9. 승인 및 서명

| 항목 | 내용 | 날짜 |
|------|------|------|
| **결정일** | 2026-01-30 | - |
| **효력 개시** | Stage 0 기간 | - |
| **향후 재검토** | Stage 1 착수 시 (업그레이드 필요도 평가) | 2026 H2 예정 |

---

**문서 종료**
