# Plan: 해상도 적응형 레이아웃 재설계 (PRD-0004)

**Plan ID**: resolution-layout
**Created**: 2026-02-18
**Complexity**: STANDARD 3/5
**Target Files**: 2개 파일, 7개 섹션

---

## 1. 컨텍스트

### 원본 요청

EBS Server UI (PRD-0004)의 레이아웃을 해상도 적응형(SD~4K)으로 전면 재설계.

### 배경

PokerGFX/EBS의 송출 해상도는 SD(480p)~4K(3840×2160)로 다양하다. 현재 PRD-0004 설계는 고정 레이아웃으로 해상도 변화를 고려하지 않는다.

### PokerGFX 역설계 결과 (참조 데이터)

역설계에서 확인된 PokerGFX의 해상도 적응 메커니즘:

| 클래스/속성 | 설명 |
|------------|------|
| `renderer._w`, `renderer._h` | 현재 출력 해상도 |
| `renderer._scale` | Size2F 스케일 팩터 (기준 해상도 대비 현재 해상도 비율) |
| `RenderConfig.video_w`, `video_h` | 렌더링 설정의 해상도 값 |
| `image_element._scale` | 요소별 해상도 적응 스케일 |
| Anchor 개념 | 해상도 변경 시 요소의 기준점 (TopLeft, Center 등) |

---

## 2. 현재 설계의 문제점 (As-Is)

### 문제 1: M-02 Preview Panel (2장, 2.7절)

```
현재: "M-02 | Preview Panel | Canvas | 16:9 비율 고정, Chroma Key Blue..."
```

- "16:9 비율 고정"만 명시
- 출력 해상도가 변경될 때 Preview 크기가 어떻게 바뀌는지 정책 없음
- 480p Preview와 4K Preview의 픽셀 밀도 차이 미고려

### 문제 2: 1.5 공통 레이아웃 (1장, 1.5절)

```
현재: "Preview(좌) + Control(우) 2-column 레이아웃"
```

- 2열 비율이 고정값으로 암묵적 전제
- 해상도별로 Preview 최적 크기가 다름 (SD는 작아도 무방, 4K는 크게 봐야 함)
- 앱 윈도우 자체 크기와 Preview 크기의 관계 미정의

### 문제 3: Graphic Editor Position LTWH (9장, 9.6절)

```
현재: "Position (LTWH) | Left/Top/Width/Height 픽셀 단위"
```

- 픽셀 단위는 해상도 종속적
- 1080p에서 설정한 L=100 값이 4K에서 의미가 달라짐
- 해상도 변경 시 기존 스킨의 모든 요소 좌표가 깨짐

### 문제 4: SK-04 4K Design (8장, 8.7절)

```
현재: "SK-04 | 4K Design | 체크박스"
```

- 체크박스 ON/OFF만 정의
- 체크 시 실제로 무슨 일이 일어나는지 미정의
- 4K 전용 스킨과 1080p 스킨의 관계 미정의

### 문제 5: O-01 해상도 변경 파급 효과 (4장, 4.7~4.8절)

```
현재: 4.8 Interaction Patterns:
"O-01 해상도 변경 | 전체 파이프라인 재초기화 | 잠시 Preview 블랙아웃 후 복구"
```

- "파이프라인 재초기화"만 언급
- Preview 스케일 재계산 미언급
- GFX 좌표 시스템 재매핑 미언급
- 스킨 해상도 호환성 확인 미언급

### 문제 6: GFX Margin (5장, 5.7절)

```
현재: G-03~G-05 | X/Top/Bot Margin | % 단위
```

- 마진은 % 단위(올바름)이지만, 다른 위치/크기 설정(LTWH)과 단위 불일치
- 단위 체계가 혼재하여 구현 시 혼란 예상

---

## 3. 수정 목표 (To-Be)

### 핵심 원칙

1. **해상도 독립적 좌표 시스템**: 모든 위치/크기 값은 정규화 좌표(0.0~1.0) 또는 기준 해상도(1920×1080) 기준
2. **스케일 팩터 명시**: 해상도 변경 시 자동 적용되는 스케일 계산 공식 정의
3. **Anchor 기반 배치**: 해상도 변경 시 요소가 어떤 기준점에서 확장되는지 명시
4. **4K Design 동작 정의**: SK-04 체크 시 실제 스케일링 동작 명세

---

## 4. 수정 대상 파일 및 섹션

### 파일 1: `PRD-0004-EBS-Server-UI-Design.md`

| 수정 섹션 | 현재 위치 | 수정 내용 |
|----------|----------|----------|
| **1.5 공통 레이아웃** | 1장 | 해상도 적응형 2-column 비율 정책 추가 |
| **2.7 Element Catalog (M-02)** | 2장 | Preview Panel 해상도 스케일링 스펙 추가 |
| **4.7~4.8 Outputs** | 4장 | O-01 해상도 변경의 전체 파급 효과 정의 |
| **5.7 Layout 서브탭 (G-01~G-13)** | 5장 | Margin 단위 통일 + 좌표계 정책 명시 |
| **8.7 Element Catalog (SK-04)** | 8장 | 4K Design 체크박스 동작 정의 |
| **9.6 Element Catalog (Position LTWH)** | 9장 | 픽셀 → 정규화 좌표 시스템 재설계 |

### 파일 2: `PRD-0004-technical-specs.md`

| 수정 섹션 | 현재 위치 | 수정 내용 |
|----------|----------|----------|
| **신규: 렌더링 파이프라인 해상도 적응** | 4장 신규 | 스케일 팩터, 좌표 변환, Anchor 메커니즘 정의 |

---

## 5. 세부 작업 목록

### Task 1: 1.5 공통 레이아웃 — 해상도 적응 원칙 추가

**대상**: `PRD-0004-EBS-Server-UI-Design.md` 1.5절

**현재 텍스트**:
```
모든 탭이 공유하는 구조: Title Bar > Preview Panel(좌, 16:9 Chroma Key) +
Status/Quick Actions(우) > Tab Navigation > Tab Content Area.
```

**추가할 내용**:
- 앱 윈도우 최소/최대 크기 정책 (최소: 1280×720, 최대: 앱 윈도우 크기에 따라 가변)
- Preview Panel과 Control Panel의 기본 비율 (6:4) 및 해상도별 권장 비율
- 고해상도(4K) 모니터에서 앱 윈도우 스케일 처리 방식 (OS DPI 스케일링 따름)

**수용 기준**: 운영자가 SD 모니터(1024×768)에서도, 4K 모니터(3840×2160)에서도 레이아웃 원칙을 이해할 수 있도록 명시

---

### Task 2: M-02 Preview Panel — 해상도 스케일링 스펙 추가

**대상**: `PRD-0004-EBS-Server-UI-Design.md` 2.7절 M-02 행

**현재 내용**:
```
M-02 | Preview Panel | Canvas | 16:9 비율 고정, Chroma Key Blue, GFX 오버레이 실시간 렌더링
```

**추가할 스펙**:
- Preview는 출력 해상도(O-01)와 동일한 비율 유지 (현재: 16:9 고정, 9x16 모드: 9:16)
- Preview 캔버스 픽셀 크기: `UI_Panel_Width × 9/16` (16:9 기준)
- 출력 해상도 변경(O-01) 시 Preview 재렌더링 (블랙아웃 없이 즉시 리스케일)
- 고해상도 출력(4K) 시 Preview는 UI 공간 내 최대 크기로 표시 (업스케일 없음)
- 저해상도 출력(SD 480p) 시 Preview는 실제 픽셀 크기 또는 2x 확대 표시

**수용 기준**: 출력 해상도 변경 후 Preview가 올바른 비율로 즉시 갱신되는 동작을 구현자가 이해할 수 있도록 명시

---

### Task 3: O-01 해상도 변경 파급 효과 — 전체 체인 정의

**대상**: `PRD-0004-EBS-Server-UI-Design.md` 4.8절 Interaction Patterns

**현재 내용**:
```
O-01 해상도 변경 | 전체 파이프라인 재초기화 | 잠시 Preview 블랙아웃 후 복구
```

**재정의할 내용** (순서대로):

1. 해상도 변경 트리거
   - O-01 Video Size 드롭다운에서 새 해상도 선택
   - 확인 다이얼로그: "해상도를 변경하면 출력이 2~3초 중단됩니다"

2. 파이프라인 재초기화 단계 (순서)
   a. Live 출력 스트림 중단 (Delay 출력은 추후 개발)
   b. 렌더러 해상도 재설정 (`renderer._w`, `renderer._h` 갱신)
   c. 스케일 팩터 재계산: `scale = new_resolution / base_resolution(1920×1080)`
   d. GFX 좌표 시스템 재매핑 (모든 요소 정규화 좌표 → 새 픽셀 좌표 변환)
   e. 현재 적용된 스킨 해상도 호환성 확인 (SK-04 상태 검사)
   f. Preview 캔버스 크기 재계산
   g. 출력 스트림 재시작

3. 피드백 순서
   - 변경 중: Preview 블랙아웃 (2~3초)
   - 완료 후: Preview 즉시 복구, O-01에 새 해상도 표시
   - 스킨 비호환 감지 시: 경고 토스트 "현재 스킨이 4K 최적화되지 않았습니다. SK-04를 확인하세요."

**수용 기준**: 구현자가 해상도 변경 이벤트의 전체 처리 순서를 파악할 수 있도록 명시

---

### Task 4: GFX Margin 및 좌표계 원칙 — 단위 통일

**대상**: `PRD-0004-EBS-Server-UI-Design.md` 5.7절 Layout 서브탭 앞에 설명 섹션 추가

**추가할 내용**: GFX 좌표계 원칙 설명 블록

```
#### GFX 좌표계 원칙

EBS GFX의 모든 위치/크기 값은 기준 해상도(1920×1080) 기반 정규화 좌표를 사용한다.

| 단위 | 범위 | 사용 항목 |
|------|------|----------|
| 정규화 좌표 (float) | 0.0 ~ 1.0 | Margin (%, 0.04 = 4%) |
| 기준 픽셀 (int) | 0 ~ 1920 또는 0 ~ 1080 | Graphic Editor LTWH (기준 해상도 기준) |

**해상도 변경 시 자동 변환**: 정규화 좌표는 변환 불필요. 기준 픽셀값은 스케일 팩터 적용.
예: 1080p에서 L=100 → 4K에서 L=200 (scale=2.0 자동 적용).
```

**수용 기준**: G-03~G-05(Margin, % 단위)와 Graphic Editor LTWH(픽셀 단위)의 단위 차이와 해상도 변경 시 처리 방식이 명확히 설명됨

---

### Task 5: SK-04 4K Design — 동작 정의

**대상**: `PRD-0004-EBS-Server-UI-Design.md` 8.7절 SK-04 행 + 설명 추가

**현재 내용**:
```
SK-04 | Info | 4K Design | 체크박스 | #4 | P1
```

**추가할 내용**: SK-04 행 설명 확장 + 8.5 Design Decisions에 항목 추가

SK-04 행 확장:
```
SK-04 | Info | 4K Design | Checkbox | 이 스킨이 4K(3840×2160) 기준으로 디자인되었음을 표시.
체크 시: Graphic Editor의 기준 좌표계가 3840×2160으로 전환됨.
미체크(기본): 기준 좌표계 1920×1080.
O-01이 4K인데 SK-04 미체크 시: 경고 표시 (스킨 업스케일 적용됨).
O-01이 1080p인데 SK-04 체크 시: 경고 표시 (스킨 다운스케일 적용됨).
| #4 | P1
```

8.5 Design Decisions 추가 항목:
```
4. **SK-04 4K Design이 체크박스인 이유**: 스킨은 특정 해상도를 기준으로 제작된다.
   이 플래그는 "이 스킨의 원본 좌표계가 무엇인지"를 선언한다.
   런타임에 출력 해상도(O-01)와 스킨 기준 해상도(SK-04)가 다르면 스케일 변환이 자동 적용된다.
   단, 업스케일(1080p 스킨 → 4K 출력)은 품질 저하 가능성이 있으므로 경고를 표시한다.
```

**수용 기준**: SK-04 체크/미체크의 동작, 출력 해상도와의 관계, 경고 조건이 명확히 정의됨

---

### Task 6: Graphic Editor 좌표 시스템 — 해상도 독립적 재설계

**대상**: `PRD-0004-EBS-Server-UI-Design.md` 9.6절 Element Catalog (Board/공통 편집 기능)

**현재 내용**:
```
Position (LTWH) | Left/Top/Width/Height 픽셀 단위
Anchor | 해상도 변경 시 기준점
```

**재정의할 내용**:

Position (LTWH) 설명 확장:
```
Position (LTWH) | Left/Top/Width/Height.
단위: 기준 해상도(SK-04에 따라 1920×1080 또는 3840×2160)의 픽셀.
표시 형식: 정수 픽셀값 (예: L=100, T=50, W=400, H=200).
해상도 변경 시: 스케일 팩터 자동 적용 (운영자가 직접 수정 불필요).
```

Anchor 설명 확장:
```
Anchor | 해상도 변경 시 요소의 기준점.
옵션: TopLeft / TopRight / BottomLeft / BottomRight / Center / TopCenter / BottomCenter.
예: TopRight 앵커 → 해상도 변경 시 오른쪽 상단 기준으로 위치 유지.
기본값: TopLeft.
PokerGFX 참조: renderer Anchor 개념과 동일.
```

Z-order와 Angle 사이에 새 항목 추가:
```
Coordinate Display | 현재 출력 해상도 기준 실제 픽셀값 미리보기.
예: 기준(1920×1080) L=100 → 4K(3840×2160) 실제 L=200 으로 표시.
편집은 기준 해상도 값으로만 가능 (실제 픽셀값은 읽기 전용 참조용).
```

**수용 기준**: 구현자가 Graphic Editor의 좌표값이 어떤 해상도 기준인지, 해상도 변경 시 어떻게 변환되는지 이해할 수 있도록 명시

---

### Task 7: 기술 명세서 — 렌더링 파이프라인 해상도 적응 메커니즘 추가

**대상**: `PRD-0004-technical-specs.md` — 신규 4장 추가

**추가할 장 구조**:

```markdown
## 4장: 렌더링 파이프라인 해상도 적응 (Resolution Adaptation)

### 4.1 기준 해상도 및 스케일 팩터

기준 해상도: 1920×1080 (Full HD)
스케일 팩터: scale = (현재_출력_해상도) / (기준_해상도)

| 출력 해상도 | scale_x | scale_y | 비고 |
|------------|:-------:|:-------:|------|
| SD 480p (854×480) | 0.445 | 0.444 | 다운스케일 |
| HD 720p (1280×720) | 0.667 | 0.667 | 다운스케일 |
| FHD 1080p (1920×1080) | 1.000 | 1.000 | 기준 (변환 없음) |
| QHD 1440p (2560×1440) | 1.333 | 1.333 | 업스케일 |
| 4K UHD (3840×2160) | 2.000 | 2.000 | 업스케일 |

### 4.2 좌표 변환 공식

pixel_actual = pixel_base * scale

예: 기준 해상도 L=100 → 4K 출력 실제 L=200

### 4.3 정규화 좌표 (Normalized Coordinates)

% 기반 마진(G-03~G-05)은 정규화 좌표이므로 스케일 변환 불필요:
margin_pixel = margin_normalized * output_width

### 4.4 Anchor 동작

해상도 변경 시 각 요소의 기준점(Anchor)에서 스케일 확장:
- TopLeft: (L*sx, T*sy) — 좌상단 고정
- Center: (cx*sx, cy*sy) — 중심점 고정
- 등...

PokerGFX 역설계 참조: renderer._scale (Size2F), image_element._scale

### 4.5 SK-04 스킨 기준 해상도

스킨의 SK-04 설정에 따라 Graphic Editor의 기준 해상도가 달라짐:
- SK-04 OFF → 기준: 1920×1080 (FHD 스킨)
- SK-04 ON  → 기준: 3840×2160 (4K 스킨)

출력 해상도(O-01)와 스킨 기준 해상도(SK-04)가 다를 경우:
- 경고 표시 (품질 저하 가능성)
- 자동 스케일 변환 적용 (운영 가능하나 비권장)

### 4.6 해상도 변경 이벤트 처리 순서

(O-01 변경 시 전체 처리 체인 — Task 3과 연동)
```

**수용 기준**: 개발자가 렌더링 파이프라인에서 해상도 스케일링을 어떻게 구현할지 이 명세를 보고 판단 가능

---

## 6. 수정 제외 범위 (Must NOT 변경)

| 항목 | 이유 |
|------|------|
| Element ID 체계 (M-02, G-01 등) | 변경 시 cross-reference 전체 깨짐 |
| 184개 요소 수 | 이미 확정된 설계 지표 |
| 2-column 기본 레이아웃 구조 | 검증된 PokerGFX 계승 설계 |
| Commentary 탭 배제 결정 | 별도 논의 없이 번복 금지 |
| 우선순위 분류 (P0/P1/P2) | 해상도 관련 내용 추가지만 우선순위 자체 변경 없음 |
| GFX Margin % 단위 | 이미 올바른 정규화 좌표 — 변경하면 오히려 잘못됨 |

---

## 7. 수용 기준 (Definition of Done)

- [ ] 1.5절: 해상도 적응 레이아웃 원칙이 텍스트로 명시됨
- [ ] M-02: 출력 해상도 변경 시 Preview 스케일링 동작이 명시됨
- [ ] O-01: 해상도 변경의 전체 처리 단계가 순서대로 명시됨
- [ ] 5.7절: GFX 좌표계 원칙 설명 블록이 추가됨 (정규화 vs 기준 픽셀)
- [ ] SK-04: 체크/미체크 동작, 출력 해상도와의 관계, 경고 조건이 명시됨
- [ ] Graphic Editor LTWH: 기준 해상도 기준임이 명시, Anchor 옵션 목록 추가됨
- [ ] technical-specs.md 4장: 스케일 팩터 공식, 좌표 변환, Anchor 메커니즘 추가됨
- [ ] 모든 수정은 텍스트/표 형식 (불필요한 시각 다이어그램 금지)
- [ ] 기존 Element ID 체계 유지

---

## 8. 커밋 전략

단일 커밋으로 처리 (두 파일, 관련 변경):

```
docs(prd-0004): 해상도 적응형 레이아웃 스펙 추가
```

---

## 9. 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 1.0.0 | 2026-02-18 | 초안 작성 |
