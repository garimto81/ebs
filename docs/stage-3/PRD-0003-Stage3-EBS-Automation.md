# PRD-0003-Stage3: EBS 독창적 자동화

**버전**: 1.0.0
**생성일**: 2026-01-28
**상위 문서**: [PRD-0003-EBS-RFID-System.md](PRD-0003-EBS-RFID-System.md)
**전제조건**: Stage 2 Gate 통과 (2027년 12월)
**목표 기간**: 2028년 전체 (12개월)

---

## 1. Stage 3 개요

### 1.1 목표

> **"운영자 입력 80% 감소 - 손이 아닌 시스템이 일한다"**

Stage 3는 EBS만의 독창적인 자동화 시스템을 구현합니다.
WSOP+ 연동(Stage 2)을 기반으로 팟 계산, 칩 추적, 액션 감지를 자동화합니다.

### 1.2 핵심 원칙

| 원칙 | 설명 |
|------|------|
| **자동 우선** | 가능한 모든 것을 자동화 |
| **수동 폴백** | 자동화 실패 시 수동 입력 가능 |
| **정확성 100%** | 팟 계산은 100% 정확해야 함 |

### 1.3 전제조건

- [ ] Stage 2 Gate 100% 통과
- [ ] WSOP+ 동기화 안정화
- [ ] Stage 2 데이터 축적 (최소 100 핸드)

---

## 2. 자동화 대상

### 2.1 팟 사이즈 자동 계산

**현재 (Stage 1-2)**: 운영자가 베팅 금액 입력 → 팟 수동 합산
**목표 (Stage 3)**: 베팅 액션 입력 즉시 자동 계산

```
[액션 입력: Player A raises to 5,000]
        │
        ▼
[이전 팟: 2,500] + [현재 베팅: 5,000 - 1,000(콜금액)] = [새 팟: 6,500]
        │
        ▼
[자동 표시: POT $6,500]
```

**구현 로직**:
- 베팅 액션 → 팟 즉시 갱신
- 사이드 팟 자동 분리
- 올인 상황 자동 처리

### 2.2 칩 카운트 실시간 추적

**현재 (Stage 1-2)**: 핸드 시작 시 수동 입력, 브레이크 시 보정
**목표 (Stage 3)**: 모든 베팅에서 실시간 차감/추가

```
초기 스택: 50,000
    │
    ├── Bet 2,000 → 48,000
    ├── Raise 5,000 → 43,000
    ├── Win 15,000 → 58,000
    │
    └── WSOP+ 보정 (브레이크): 확정
```

### 2.3 액션 자동 감지 (옵션/실험적)

**방식**: 칩 이동 영상 분석
**정확도 목표**: 95%+
**폴백**: 감지 실패 시 수동 입력

| 감지 액션 | 방법 | 정확도 |
|----------|------|--------|
| 폴드 | 카드 던지기 감지 | 90% |
| 올인 | 전체 칩 이동 | 85% |
| 체크 | 테이블 탭 | 70% |

> ⚠️ **실험적 기능**: 초기에는 "제안" 모드로 운영 (운영자 확인 필요)

---

## 3. 자동화 알고리즘

### 3.1 팟 계산 알고리즘

```python
def calculate_pot(current_pot: int, action: Action) -> int:
    """
    팟 사이즈 자동 계산

    Rules:
    - FOLD: 팟 변화 없음
    - CHECK: 팟 변화 없음
    - CALL: 콜 금액만큼 추가
    - BET: 베팅 금액 추가
    - RAISE: (레이즈 금액 - 이전 베팅) 추가
    - ALL-IN: 올인 금액 추가
    """
    if action.type in ['FOLD', 'CHECK']:
        return current_pot
    elif action.type == 'CALL':
        return current_pot + action.call_amount
    elif action.type in ['BET', 'RAISE', 'ALL-IN']:
        return current_pot + action.amount
```

### 3.2 사이드 팟 분리

```python
def calculate_side_pots(players: List[Player], actions: List[Action]) -> List[Pot]:
    """
    올인 상황에서 사이드 팟 자동 분리

    Example:
    - Player A: All-in 10,000
    - Player B: Call 10,000
    - Player C: Raise 30,000

    Result:
    - Main Pot: 30,000 (A, B, C eligible)
    - Side Pot: 40,000 (B, C eligible)
    """
```

### 3.3 칩 추적 알고리즘

```python
def update_chip_count(player: Player, action: Action) -> int:
    """
    베팅 액션에 따른 칩 실시간 차감
    """
    if action.type == 'FOLD':
        return player.chips  # 변화 없음
    elif action.type in ['BET', 'RAISE', 'CALL']:
        return player.chips - action.amount
    elif action.type == 'ALL-IN':
        return 0
    elif action.type == 'WIN':
        return player.chips + action.pot_amount
```

---

## 4. UI 변경사항

### 4.1 자동 계산 표시

| 요소 | Stage 2 | Stage 3 |
|------|---------|---------|
| 팟 표시 | 수동 입력값 | 자동 계산 (실시간) |
| 칩 표시 | 초기값 고정 | 실시간 업데이트 |
| 베팅 표시 | 수동 입력 | 자동 추론 (옵션) |

### 4.2 수동 오버라이드 UI

```
┌─────────────────────────────────┐
│ 자동 계산: POT $6,500          │
│ ────────────────────────────── │
│ [수정] → 수동 입력 모드        │
│ [확정] → 자동 계산 사용        │
└─────────────────────────────────┘
```

### 4.3 자동화 설정 패널

| 설정 | 옵션 | 기본값 |
|------|------|--------|
| 자동 팟 계산 | ON/OFF | ON |
| 칩 실시간 추적 | ON/OFF | ON |
| 액션 자동 감지 | ON/OFF/제안 | 제안 |
| 오류 시 경고음 | ON/OFF | ON |

---

## 5. 성능 요구사항

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| 팟 계산 지연 | < 100ms | E2E 측정 |
| 칩 동기화 지연 | < 500ms | 베팅 후 표시까지 |
| CPU 사용률 | < 30% | 8코어 기준 |
| 메모리 사용 | < 500MB | 4시간 운영 후 |

---

## 6. 분기별 개발 계획

**전체 기간**: 2028년 1월 - 12월 (12개월)

| 분기 | 마일스톤 | 기능 | Definition of Done |
|------|----------|------|-------------------|
| Q1 (1-3월) | Alpha | 자동 팟 계산 | 정확도 100% (100 핸드), 사이드 팟 분리 |
| Q2 (4-6월) | Beta | 칩 실시간 추적 | ±1% 오차 이내, 실시간 업데이트 |
| Q3 (7-9월) | RC | 액션 자동 감지 | 제안 모드 동작, 정확도 95%+ |
| Q4 (10-12월) | Release | 최적화 + 안정화 | 입력 80% 감소 검증, 8시간 연속 운영 |

---

## 7. 성공 기준

### 7.1 핵심 지표

| 지표 | 목표 |
|------|------|
| 운영자 입력 감소 | Stage 1 대비 80% |
| 팟 계산 정확도 | 100% |
| 칩 추적 정확도 | 99%+ |
| 시스템 가동률 | 99.9% |

### 7.2 입력 감소 상세

| 항목 | Stage 1 | Stage 3 | 감소율 |
|------|---------|---------|--------|
| 팟 사이즈 | 수동 | 자동 | 100% |
| 칩 카운트 | 수동 | 자동 | 100% |
| 베팅 금액 | 수동 | 자동 추론 | 80% |
| 플레이어 액션 | 수동 | 제안 모드 | 50% |
| **평균** | - | - | **80%** |

---

## 8. Stage 3 완료 조건 (정량적)

**완료 시기**: 2028년 12월

프로젝트 완료를 위해 다음 조건을 **모두** 충족해야 합니다:

| 조건 | 기준 | 검증 방법 |
|------|------|----------|
| 자동화율 | 운영자 입력 Stage 1 대비 80% 감소 | 입력 횟수 비교 |
| 팟 계산 | 정확도 100% (100핸드 무오류) | 수동 검증 |
| 시스템 안정성 | 8시간 연속 운영 99.9% 가동률 | 모니터링 |
| 성능 | 팟 계산 < 100ms, 칩 동기화 < 500ms | 성능 테스트 |

---

## 9. Definition of Done

### 개발

- [ ] 자동 팟 계산 구현 (정확도 100%)
- [ ] 사이드 팟 자동 분리
- [ ] 칩 카운트 실시간 추적
- [ ] 수동 오버라이드 UI
- [ ] 자동화 설정 패널

### 검증

- [ ] 100핸드 무오류 팟 계산
- [ ] 8시간 연속 운영 테스트
- [ ] 입력 80% 감소 측정 완료

### 문서화

- [ ] 자동화 알고리즘 문서
- [ ] 운영자 가이드 업데이트
- [ ] 트러블슈팅 가이드

---

## 10. 위험 요소 및 대응

| 위험 | 영향도 | 대응 |
|------|--------|------|
| 팟 계산 오류 | 고 | 수동 오버라이드 + 경고 |
| 액션 감지 실패 | 중 | 제안 모드 (확인 필요) |
| 성능 저하 | 중 | 비동기 처리 + 캐싱 |

---

## 11. 다음 단계 (Post-Stage 3)

Stage 3 완료 후 고려 가능한 확장:

| 기능 | 설명 | 우선순위 |
|------|------|----------|
| AI 해설 | 자동 생성 해설 텍스트 | P2 |
| 하이라이트 자동 생성 | 빅 팟 클립 자동 추출 | P2 |
| 예측 분석 | 플레이어 행동 예측 | P3 |

---

## 12. 문서 정보

| 항목 | 내용 |
|------|------|
| **문서 버전** | 1.0.0 |
| **작성일** | 2026-01-28 |
| **상태** | Draft |

