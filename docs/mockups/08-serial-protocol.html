<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1280, height=800">
    <title>EBS Serial Protocol - Message Flow Diagram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 1280px;
            height: 800px;
            background: #FFF;
            font-family: 'Consolas', 'Courier New', monospace;
            color: #000;
            padding: 40px;
            overflow: hidden;
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
            border-bottom: 3px solid #000;
            padding-bottom: 16px;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: -0.5px;
            margin-bottom: 8px;
        }

        .header .subtitle {
            font-size: 14px;
            color: #666;
            letter-spacing: 0.5px;
        }

        .protocol-config {
            background: #F5F5F5;
            border: 2px solid #000;
            padding: 12px 20px;
            margin-bottom: 24px;
            text-align: center;
            font-size: 13px;
            font-weight: 700;
        }

        .protocol-config span {
            margin: 0 16px;
        }

        .sequence-diagram {
            position: relative;
            height: 480px;
            margin-bottom: 32px;
        }

        .actor {
            position: absolute;
            top: 0;
            width: 180px;
            text-align: center;
        }

        .actor.esp32 { left: 40px; }
        .actor.server { left: 420px; }
        .actor.client { left: 800px; }

        .actor-box {
            background: #000;
            color: #FFF;
            padding: 12px;
            font-size: 14px;
            font-weight: 700;
            border: 3px solid #000;
            margin-bottom: 8px;
        }

        .actor-label {
            font-size: 11px;
            color: #666;
            font-weight: 400;
        }

        .lifeline {
            position: absolute;
            top: 80px;
            width: 2px;
            height: 380px;
            background: repeating-linear-gradient(
                to bottom,
                #999 0px,
                #999 8px,
                transparent 8px,
                transparent 16px
            );
            left: 50%;
            transform: translateX(-1px);
        }

        .message {
            position: absolute;
            left: 0;
            height: 60px;
        }

        .message.msg1 { top: 100px; }
        .message.msg2 { top: 200px; }
        .message.msg3 { top: 300px; }

        .arrow {
            position: relative;
            height: 2px;
            background: #000;
        }

        .arrow.right {
            width: 360px;
        }

        .arrow.long {
            width: 740px;
        }

        .arrow::after {
            content: '';
            position: absolute;
            right: -2px;
            top: -6px;
            width: 0;
            height: 0;
            border-left: 12px solid #000;
            border-top: 7px solid transparent;
            border-bottom: 7px solid transparent;
        }

        .msg-label {
            position: absolute;
            top: -24px;
            left: 50%;
            transform: translateX(-50%);
            background: #FFF;
            padding: 4px 12px;
            font-size: 12px;
            font-weight: 700;
            white-space: nowrap;
            border: 1px solid #CCC;
        }

        .msg-json {
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            background: #F5F5F5;
            border: 1px solid #999;
            padding: 8px 12px;
            font-size: 10px;
            white-space: pre;
            max-width: 280px;
        }

        .field-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            margin-top: 8px;
        }

        .field-table th {
            background: #000;
            color: #FFF;
            padding: 8px;
            text-align: left;
            font-weight: 700;
            border: 1px solid #000;
        }

        .field-table td {
            padding: 6px 8px;
            border: 1px solid #CCC;
            background: #FFF;
        }

        .field-table td:nth-child(1) {
            font-weight: 700;
            font-family: 'Consolas', monospace;
        }

        .field-table td:nth-child(2) {
            color: #666;
            font-style: italic;
        }

        .footer {
            position: absolute;
            bottom: 24px;
            left: 40px;
            right: 40px;
            text-align: center;
            border-top: 2px solid #000;
            padding-top: 12px;
        }

        .footer .title {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .footer .desc {
            font-size: 11px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>SERIAL PROTOCOL DIAGRAM</h1>
        <div class="subtitle">ESP32 ↔ Python Server ↔ React Client 메시지 흐름</div>
    </div>

    <div class="protocol-config">
        <span>Serial: 115200 baud, 8N1</span>
        <span>│</span>
        <span>Format: JSON newline-delimited</span>
        <span>│</span>
        <span>Encoding: UTF-8</span>
    </div>

    <div class="sequence-diagram">
        <!-- Actors -->
        <div class="actor esp32">
            <div class="actor-box">ESP32</div>
            <div class="actor-label">RFID Reader</div>
            <div class="lifeline"></div>
        </div>

        <div class="actor server">
            <div class="actor-box">Python Server</div>
            <div class="actor-label">FastAPI + WebSocket</div>
            <div class="lifeline"></div>
        </div>

        <div class="actor client">
            <div class="actor-box">React Client</div>
            <div class="actor-label">Browser UI</div>
            <div class="lifeline"></div>
        </div>

        <!-- Message 1: Init -->
        <div class="message msg1" style="left: 130px;">
            <div class="arrow right"></div>
            <div class="msg-label">1. init message</div>
            <div class="msg-json">{"type":"init","status":"ready","reader_id":0}</div>
        </div>

        <!-- Message 2: Card Read -->
        <div class="message msg2" style="left: 130px;">
            <div class="arrow right"></div>
            <div class="msg-label">2. card_read</div>
            <div class="msg-json">{"type":"card_read","uid":"04:A2:B3:C4","reader_id":0,"timestamp":123456}</div>
        </div>

        <!-- Message 3: WebSocket Event -->
        <div class="message msg3" style="left: 510px;">
            <div class="arrow right"></div>
            <div class="msg-label">3. card_detected (WebSocket)</div>
            <div class="msg-json">{"type":"card_detected","uid":"04:A2:B3:C4"}</div>
        </div>
    </div>

    <table class="field-table">
        <thead>
            <tr>
                <th>Field</th>
                <th>Type</th>
                <th>Description</th>
                <th>Example</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>type</td>
                <td>string</td>
                <td>메시지 타입 (init, card_read, card_detected)</td>
                <td>"card_read"</td>
            </tr>
            <tr>
                <td>uid</td>
                <td>string</td>
                <td>카드 UID (HEX, 콜론 구분)</td>
                <td>"04:A2:B3:C4"</td>
            </tr>
            <tr>
                <td>reader_id</td>
                <td>number</td>
                <td>리더 ID (0-based, 최대 6개)</td>
                <td>0</td>
            </tr>
            <tr>
                <td>timestamp</td>
                <td>number</td>
                <td>밀리초 타임스탬프 (ESP32 millis())</td>
                <td>123456</td>
            </tr>
            <tr>
                <td>status</td>
                <td>string</td>
                <td>상태 (ready, error)</td>
                <td>"ready"</td>
            </tr>
        </tbody>
    </table>

    <div class="footer">
        <div class="title">EBS Stage 0 - Serial Communication Protocol</div>
        <div class="desc">RFID 카드 감지부터 UI 표시까지의 데이터 흐름 (목표: <200ms E2E latency)</div>
    </div>
</body>
</html>
