# EBS PoC Specification

**Version**: 1.0.0
**Date**: 2026-01-30
**Status**: Draft
**Authors**: Autopilot (Analyst + Architect)

---

## Executive Summary

사용자 요청: **"Stage 0에서도 PokerGFX와 동일한 고성능 모듈 사용 (단계적 업그레이드 아님)"**

### 핵심 발견

1. **PokerGFX의 정확한 하드웨어 스펙은 공개되지 않음** - Security Whitepaper는 의도적으로 부품 번호/제조사를 숨김
2. **"PokerGFX 수준"의 세 가지 해석**:
   - Functional parity: "PokerGFX처럼 카드를 안정적으로 읽는다" → MFRC522 충분
   - Performance parity: "동일한 읽기 거리, 다중 안테나" → ST25R3916 또는 uFR Zero 필요
   - Supply chain parity: "PokerGFX와 동일한 벤더" → FCC/FEIG 조사 필요

3. **권장 해석**: **아키텍처는 PokerGFX 수준, 하드웨어는 Stage 0용으로 시작**
   - Stage 0: MFRC522 + ESP32 (학습 최적화, $15-20)
   - Stage 1+: ST25R3911B 또는 상용급 모듈로 업그레이드 (펌웨어만 변경)

---

## Part 1: Requirements Analysis (Analyst)

### 1.1 Functional Requirements

| ID | Requirement | Priority | Notes |
|----|-------------|----------|-------|
| FR-01 | RFID 모듈 선정 | P0 | 13.56MHz HF, ISO14443A, 5cm+ 읽기 거리 |
| FR-02 | 공급원 확보 | P0 | 지속 공급 가능, 샘플 제공, 4주 이내 리드타임 |
| FR-03 | RFID 통신 성공 | P0 | 5장 카드 100%, 50회 연속 성공률 100%, <100ms 지연 |
| FR-04 | 오버레이 샘플 선정 | P1 | OBS Browser Source 호환, WebSocket 데이터 주입 |
| FR-05 | 에디터 구성 | P2 | **범위 불명확** - Card-UID 매핑 UI로 재정의 필요 |
| FR-06 | WSOP+ 연동 방안 | P2 | API 문서화, 인증 방법, 스키마 매핑 |

### 1.2 Non-functional Requirements

| ID | Requirement | Target | Notes |
|----|-------------|--------|-------|
| NFR-01 | E2E 지연 | < 200ms (목표) | RF → SPI → Serial → DB → WS → React |
| NFR-02 | 연속 운영 | 30분 (PoC) → 4시간 (Gate) | 안정성 검증 |
| NFR-03 | 카드 인식 실패율 | < 1% (1000회 중 <10회) | - |
| NFR-04 | 학습 곡선 | 팀 하드웨어 경험 없음 | MFRC522 최다 예제 |

### 1.3 Implicit Requirements

| ID | Requirement | Notes |
|----|-------------|-------|
| IR-01 | 기존 RFID 카드 호환 | 칩 타입 확인 필요 (MIFARE Classic vs DESFire) |
| IR-02 | USB Serial 자동 감지 | COM 포트 열거 차이 처리 |
| IR-03 | 복수 모듈 주문 | AliExpress 5-15% 불량률 대비 |
| IR-04 | 제네릭 테스트 카드 | 포커 카드 호환성 검증용 |
| IR-05 | 전원 안정성 | ESP32 브라운아웃 방지 3.3V 레귤레이터 |

### 1.4 Out of Scope (Stage 0 PoC)

| ID | Item | Stage |
|----|------|-------|
| OOS-01 | Secure Delay (30초 딜레이) | Stage 1 |
| OOS-02 | AES-256 / TLS 1.2 암호화 | Stage 1 |
| OOS-03 | 다중 리더 (6-10개) | Stage 1+ |
| OOS-04 | Action Tracker | Stage 1 |
| OOS-05 | 승률/통계 계산 | Stage 1 |
| OOS-06 | 플레이어 관리 | Stage 1 |

### 1.5 Undefined Guardrails (명확화 필요)

| Item | Question | Suggested Answer |
|------|----------|------------------|
| 읽기 거리 | 최소 요구사항? | **5cm** (MFRC522 기본 3-5cm) |
| Multi-card 읽기 | 2장 동시 인식? | **PoC는 단일 카드**, Stage 1에서 다중 |
| 카드 칩 타입 | 기존 카드 확인됨? | **검증 필요** (ACR122U로 확인) |
| 예산 | 최대 PoC 비용? | **$50-200 권장** (저비용 시작) |
| 보안 | PoC에서 암호화? | **제외** (Plain JSON 허용) |

---

## Part 2: Technical Specification (Architect)

### 2.1 Tech Stack

#### Hardware

| Layer | Component | Specification | Price | Rationale |
|-------|-----------|--------------|-------|-----------|
| MCU | ESP32-WROOM-32 | Dual-core 240MHz, WiFi+BT, 3.3V | $5-10 | 최다 예제, SPI 네이티브 |
| RFID Reader | MFRC522 | 13.56MHz ISO14443A, SPI | $1-5 | miguelbalboa/rfid 라이브러리 |
| Test Cards | MIFARE Classic 1K | 13.56MHz, 4/7-byte UID | $0.50/ea | 기존 보유 또는 OEM |

**Stage 1+ 업그레이드 경로:**
- MFRC522 → ST25R3911B ($25-40) - 펌웨어만 수정
- ESP32-WROOM → ESP32-S3 ($7-14) - USB OTG 추가

#### Software

| Layer | Technology | Version | Rationale |
|-------|------------|---------|-----------|
| Firmware | Arduino C++ + ArduinoJson | ESP32 Core 2.0+ | MFRC522 라이브러리 |
| Server | Python + FastAPI | 3.11+, 0.100+ | 비동기 WebSocket, pyserial |
| Database | SQLite | 3.x | PokerGFX도 SQLite 지원 |
| Frontend | React + TypeScript | 18+, 5.0+ | OBS Browser Source 호환 |

### 2.2 Architecture Overview

```
┌─────────────────────────────────────────────────────────────┐
│                    EBS Stage 0 Architecture                 │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Layer 4: Presentation                                      │
│  ├── React UI (Viewer)                                      │
│  ├── OBS Overlay (Browser Source)                           │
│  └── Admin Panel (Card Management)                          │
│           │                                                 │
│           │ WebSocket (ws://localhost:8000/ws)              │
│           ▼                                                 │
│  Layer 3: Application Server                                │
│  ├── FastAPI Server                                         │
│  ├── REST API (/api/*)                                      │
│  ├── WebSocket Handler                                      │
│  └── Serial Manager (pyserial async)                        │
│           │                                                 │
│           │ Serial (USB, 115200 baud, JSON)                 │
│           ▼                                                 │
│  Layer 2: Data Layer                                        │
│  ├── SQLite DB (cards.db)                                   │
│  ├── Card Cache (In-Memory)                                 │
│  └── Event Queue (asyncio)                                  │
│           │                                                 │
│           │ SPI (10MHz) + Serial JSON                       │
│           ▼                                                 │
│  Layer 1: Firmware (ESP32)                                  │
│  ├── SPI Driver (ESP32 HAL)                                 │
│  ├── ArduinoJson (Serializer)                               │
│  └── MFRC522 Lib (miguelbalboa)                             │
│           │                                                 │
│           │ 13.56MHz RF (ISO14443A)                         │
│           ▼                                                 │
│  Layer 0: Physical                                          │
│  ├── ESP32-WROOM (DevKit V1)                                │
│  ├── MFRC522 (Module)                                       │
│  └── RFID Card (MIFARE 1K)                                  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 File Structure

```
C:\claude\ebs\
├── firmware/                    # ESP32 펌웨어
│   └── rfid_reader/
│       ├── rfid_reader.ino      # 메인 스케치
│       ├── config.h             # 핀 설정
│       └── serial_protocol.cpp  # JSON 직렬화
│
├── server/                      # Python 백엔드
│   ├── app/
│   │   ├── main.py              # FastAPI 진입점
│   │   ├── services/
│   │   │   ├── serial_service.py
│   │   │   └── websocket_service.py
│   │   └── api/
│   │       └── routes.py
│   ├── data/
│   │   └── cards.db
│   └── requirements.txt
│
├── frontend/                    # React 프론트엔드
│   └── src/
│       ├── App.tsx
│       ├── components/
│       └── hooks/
│           └── useWebSocket.ts
│
└── docs/                        # 문서
```

### 2.4 Dependencies

**Hardware BOM (~$15-20):**
- ESP32-WROOM-32 DevKit: $5-10
- MFRC522 Module: $1-5
- Test Cards (5장): $2.50
- Jumper Wires: $1
- USB Cable: $2

**Software:**
```
# Python
fastapi>=0.100.0
uvicorn[standard]>=0.23.0
pyserial>=3.5
websockets>=11.0

# Node.js
react: ^18.2.0
typescript: ^5.0.0
vite: ^4.4.0
```

### 2.5 Serial Protocol

**ESP32 → Server (115200 baud, JSON):**

```json
{"type":"card_read","uid":"04:A2:B3:C4","reader_id":0,"timestamp":12345}
```

### 2.6 WebSocket Events

**Server → Client:**

```json
{"type":"card_detected","uid":"...","card":{"suit":"spades","rank":"A","display":"A♠"},"timestamp":...}
```

### 2.7 Supplier Recommendations

| Category | Supplier | Price | Notes |
|----------|----------|-------|-------|
| **Cards (프리미엄)** | Faded Spade | $599/4덱 | WPT 공식 |
| **Cards (OEM)** | RFIDup.com | $98-198/덱 | 소량 가능 |
| **Reader (Stage 0)** | AliExpress | $1-5 | MFRC522 |
| **Reader (Stage 1+)** | Waveshare | $25-40 | ST25R3911B |
| **MCU** | AliExpress/Amazon | $5-10 | ESP32 DevKit |

---

## Part 3: Recommendations

### 3.1 명확화 필요 항목 (Before Purchase)

| Item | Action | Owner | Deadline |
|------|--------|-------|----------|
| "PokerGFX 수준" 정의 | 5개 측정 기준 확정 | PM | 구매 전 |
| 기존 카드 검증 | ACR122U로 칩 타입 확인 | Dev | 구매 전 |
| 예산 확정 | PoC 하드웨어 최대 비용 | PM | 구매 전 |

### 3.2 Scope 명확화

| Goal | Current State | Recommendation |
|------|---------------|----------------|
| Goal 5 (에디터) | 범위 불명확 | "Card-UID 매핑 UI"로 재정의 또는 Stage 1 이동 |
| Goal 6 (WSOP+ 연동) | API 접근 미확인 | 문서/계정 관리자 확인 필요 |

### 3.3 De-risking

| Risk | Mitigation |
|------|------------|
| 모듈 DOA | 2-3개 주문 |
| 카드 비호환 | 제네릭 MIFARE 1K 테스트 카드 함께 주문 |
| 학습 곡선 | MFRC522 최다 예제 활용 |

---

## Part 4: Acceptance Criteria

### 4.1 Stage 0 Gate Criteria

| Condition | Criteria | Verification |
|-----------|----------|--------------|
| RFID 읽기 | 5장 카드 100% 인식 | 테스트 로그 |
| E2E 지연 | 카드 → 화면 < 1초 | 타임스탬프 |
| 연속 운영 | 4시간 무중단 | 모니터링 |
| 팀 합의 | "Stage 1 진행 가능" | 회의록 |
| 문서화 | 4개 가이드 완성 | 검토 |

### 4.2 PoC Goals Acceptance

| Goal | Measurable Criteria |
|------|---------------------|
| 1. 모듈 선정 | 13.56MHz HF, ISO14443A, 5cm+, ESP32 호환, SDK 제공, $50 미만 |
| 2. 공급원 확보 | 7일 응답, 10/100/1000 가격 제공, 4주 리드타임, 샘플 제공 |
| 3. 통신 성공 | 5장 인식, 50회 100%, <100ms, 30분 안정 |
| 4. 오버레이 샘플 | OBS 호환, WebSocket 주입, MIT/Apache 라이선스 |
| 5. 에디터 | Card-UID 매핑 UI 또는 Stage 1 이동 |
| 6. WSOP+ 연동 | API 문서, 인증, 스키마 매핑, 레이트 리밋 |

---

**EXPANSION_COMPLETE**

다음 단계: Phase 1 (Planning) - 구현 계획 수립
